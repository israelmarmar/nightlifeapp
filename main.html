  
 <!DOCTYPE html>
<html >

<head>
  <meta charset="UTF-8">
   <title>Nightlife app</title>
   <link rel="stylesheet" type="text/css" href="styles.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css">

  <style>
  body {
  background-color: #1f1f7a;

}
  </style>
  
</head>

<body translate="no" >

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.1/react-dom.min.js"></script>
<script src='https://unpkg.com/axios/dist/axios.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<script type="text/babel">

var Buttong = React.createClass({
	getInitialState: function () {
    return { 
            going:0

           };
  },
  
  componentDidMount: function() {
	  
  this.setState({
            going: this.props.going,
 
          });
  },
  
  going: function(evt) {
  
  axios.get("/going?id="+evt.target.id)
     
        .then(function(result) {    
			
		  if(result.data.msg=="User is not signed")
          window.location.href="/request-token";
		  else
		  th.setState({
            going: result.data.msg,
 
          });
			
          });
      

  },
  
  render: function () {
  return (<div><button id={this.props.id} onClick={this.going} className="material go-button going-button">{this.state.going+" GOING"}</button></div>)
  }
  
});


var Result = React.createClass({
  
  getInitialState: function () {
    return { 
            data:[]

           };
  },
  
   componentDidMount: function() {
   
  var th = this;
    this.serverRequest = 
      axios.get("/apijson?loc="+encodeURI(this.props.loc))
     
        .then(function(result) {    
      
          th.setState({
            data: result.data,
 
          });
      
        })
     
     
  },

  render: function () {
     
	 var th=this;
		 
 console.log(this.state.data);
		
	
          return (
          <div>
	{this.state.data.map(function(item) {

          return (<div className='result'>
          <a href={item.url}><img src={item.image_url} className="image"/></a>

          <div>
          <b>{item.name+"\n"}</b>
          <div>{"Price: "+item.price}</div>
          <div>{"Rating: "+item.rating}</div>
          </div>
          <Buttong id={item.id} className="material go-button going-button" going={item.going}/>
          </div>)
		  
		  })}
	</div>
		
		)

}
  
});

$(function() {

  
	$( "#searchfield" ).on( "keydown", function(event) {
      if(event.which == 13){
      ReactDOM.unmountComponentAtNode(document.getElementById('results'));
	  ReactDOM.render(<Result loc={$("#searchfield").val()}/>, document.getElementById('results'));
	  }
	  
	  });

	
    $("#go").on("click", function() {
    ReactDOM.unmountComponentAtNode(document.getElementById('results'));
	ReactDOM.render(<Result loc={$("#searchfield").val()}/>, document.getElementById('results'));
	});

});

</script>


<div class="form-container">
    <input id="searchfield" type="text" class="search material" placeholder="Enter places of your choice"/>
	<button id="go" class="go-button material">GO</button>
  </div>
  
  <div id="results"></div>


</body>
</html>
